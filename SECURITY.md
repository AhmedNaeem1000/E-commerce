# نظام الأمان والصلاحيات

## نظرة عامة

تم تطبيق نظام أمان شامل لحماية الصفحات والوظائف في التطبيق. النظام يضمن أن المستخدمين يمكنهم الوصول فقط للصفحات والوظائف المصرح لهم بها.

## أنواع المستخدمين

### 1. الزوار (غير مسجلين)

- يمكنهم الوصول للصفحات العامة فقط
- الصفحات المتاحة:
  - الصفحة الرئيسية (`/`)
  - قائمة المنتجات (`/products`)
  - تفاصيل المنتج (`/product/:id`)
  - تسجيل الدخول (`/login`)
  - التسجيل (`/register`)

### 2. المستخدمون المسجلون

- يمكنهم الوصول لجميع الصفحات العامة + الصفحات المحمية
- الصفحات الإضافية المتاحة:
  - السلة (`/cart`)
  - المفضلة (`/wishlist`)
  - الملف الشخصي (`/profile`)
  - الإعدادات (`/settings`)
  - إتمام الشراء (`/checkout`)
  - تأكيد الطلب (`/order-confirmation`)

### 3. المشرفون (Admins)

- يمكنهم الوصول لجميع الصفحات + صفحات الإدارة
- الصفحات الإضافية المتاحة:
  - لوحة التحكم (`/admin`)
  - إضافة منتج (`/admin/add-product`)
  - تعديل منتج (`/admin/edit-product/:id`)

## بيانات تسجيل الدخول

### للمشرف:

- البريد الإلكتروني: `admin@admin.com`
- كلمة المرور: `admin123`

### للمستخدمين العاديين:

- يجب التسجيل أولاً من صفحة التسجيل
- ثم تسجيل الدخول بالبيانات المسجلة

## المكونات المستخدمة

### 1. ProtectedRoute

```jsx
<ProtectedRoute>
  <Component />
</ProtectedRoute>
```

- يحمي الصفحات التي تتطلب تسجيل دخول
- يتحقق من وجود المستخدم في localStorage
- يوجه المستخدم لصفحة تسجيل الدخول إذا لم يكن مسجل

### 2. AdminRoute

```jsx
<AdminRoute>
  <AdminComponent />
</AdminRoute>
```

- يحمي صفحات الإدارة
- يتحقق من أن المستخدم مسجل وأنه مشرف
- يوجه المستخدم لصفحة تسجيل الدخول إذا لم يكن مسجل أو مشرف

### 3. ProtectedLink

```jsx
<ProtectedLink to="/protected-page">رابط محمي</ProtectedLink>
```

- رابط محمي في Navbar
- يظهر رسالة خطأ إذا حاول المستخدم الوصول بدون تسجيل دخول

### 4. ProtectedButton

```jsx
<ProtectedButton onClick={handleAction}>زر محمي</ProtectedButton>
```

- زر محمي يتطلب تسجيل دخول
- يظهر رسالة خطأ إذا حاول المستخدم النقر بدون تسجيل دخول

## كيفية إضافة حماية جديدة

### لحماية صفحة جديدة:

```jsx
// في App.jsx
<Route
  path="/new-page"
  element={
    <ProtectedRoute>
      <NewPage />
    </ProtectedRoute>
  }
/>
```

### لحماية صفحة إدارة:

```jsx
// في App.jsx
<Route
  path="/admin/new-admin-page"
  element={
    <AdminRoute>
      <NewAdminPage />
    </AdminRoute>
  }
/>
```

### لحماية رابط في Navbar:

```jsx
import ProtectedLink from "./components/ProtectedLink";

<ProtectedLink to="/protected-page">رابط محمي</ProtectedLink>;
```

### لحماية زر:

```jsx
import ProtectedButton from "./components/ProtectedButton";

<ProtectedButton onClick={handleAction}>زر محمي</ProtectedButton>;
```

## الأمان

### التحقق من الصلاحيات:

- يتم التحقق من الصلاحيات في كل مرة يتم الوصول للصفحة
- لا يمكن الوصول للصفحات المحمية عبر الرابط المباشر
- يتم التحقق من حالة تسجيل الدخول في localStorage

### رسائل الخطأ:

- رسائل واضحة باللغتين العربية والإنجليزية
- توجيه المستخدم للصفحة المناسبة عند رفض الوصول

### حماية البيانات:

- تخزين بيانات المستخدمين في localStorage (في التطبيق الحقيقي يجب استخدام قاعدة بيانات آمنة)
- تشفير كلمات المرور (في التطبيق الحقيقي)

## ملاحظات مهمة

1. **في التطبيق الحقيقي** يجب استخدام:

   - قاعدة بيانات آمنة
   - تشفير كلمات المرور
   - JWT tokens للجلسات
   - HTTPS
   - حماية من CSRF و XSS

2. **التحقق المستمر** من الصلاحيات في كل طلب

3. **تسجيل الخروج** يمسح جميع بيانات الجلسة

4. **إعادة التوجيه** التلقائي للمستخدمين المسجلين من صفحات تسجيل الدخول والتسجيل
